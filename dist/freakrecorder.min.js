!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var a in n)("object"==typeof exports?exports:e)[a]=n[a]}}(this,(()=>(()=>{"use strict";var e={976:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});let n=0,a=!1;const s=new MutationObserver((e=>{Date.now()-n<=1e3&&e.length>0&&(a=!0,s.disconnect())}));s.observe(document.body,{childList:!0,attributes:!0,subtree:!0}),t.default=class{constructor(e,t){this.config=e,this.sendBatchEvents=t,this.lastEvent=null,this.eventQueue=[],this.batchSize=10,this.batchTime=1e4,this.debounceTimer=null,this.defaultInteractableTags=["BUTTON","A","INPUT","SELECT","TEXTAREA","DIV"]}startBatchTimer(){this.batchTimer=setInterval((()=>{this.eventQueue.length>0&&this.flushEventQueue()}),this.batchTime)}flushEventQueue(){this.eventQueue.length>0&&(this.sendBatchEvents([...this.eventQueue]),this.eventQueue=[])}init(){["click","input","scroll"].forEach((e=>{document.body.addEventListener(e,this.handleEvent.bind(this),!0)})),window.addEventListener("load",this.handlePageLoad.bind(this),!0),window.addEventListener("beforeunload",this.handelBeforeUnload.bind(this),!0),this.startBatchTimer()}handelBeforeUnload(){this.lastEvent&&this.eventQueue.push(this.lastEvent)}handlePageLoad(){const e={eventType:"pageLoad",timestamp:Date.now(),pageUrl:window.location.href,tagName:null,attributes:{},textContent:""};this.eventQueue.push(e)}sendEvent(e){this.eventQueue.push(e),this.eventQueue.length>=this.batchSize&&this.flushEventQueue()}checkIfParentHasInteractableChild(e){for(const t of e)if("INPUT"===t.nodeName)return!0;return!1}handleEvent(e){let t=e.target;if(t=this.findInteractableParent(t),t){n=Date.now(),a=!1;const i=this.extractEventData(e,t);s.observe(document.body,{childList:!0,attributes:!0,subtree:!0}),this.lastEvent&&this.lastEvent.eventType!==i.eventType&&(this.sendEvent(this.lastEvent),this.lastEvent=null),setTimeout((()=>{this.isInteractable(t)&&("DIV"===t.tagName&&a&&!this.checkIfParentHasInteractableChild(t.childNodes)?this.eventQueue.push(i):"input"===e.type&&"INPUT"===t.tagName?this.lastEvent=this.extractEventData(e,t):["DIV"].includes(t.tagName)||"input"==e.type||this.sendEvent(i)),s.disconnect()}),1e3),clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((()=>{this.lastEvent&&(this.sendEvent(this.lastEvent),this.lastEvent=null)}),15e3)}}extractEventData(e,t){var n,a,s;let i=this.getElementAttributes(t),r=this.getElementAttributes(t.parentNode.parentElement),o=this.getElementAttributes(t.parentNode.parentElement.parentNode.parentElement);return Object.keys(i).forEach((e=>{const t=i[e];i[e]=this.checkIfIsPIIDataAndClean(t)})),Object.keys(r).forEach((e=>{const t=r[e];r[e]=this.checkIfIsPIIDataAndClean(t)})),Object.keys(o).forEach((e=>{const t=o[e];o[e]=this.checkIfIsPIIDataAndClean(t)})),{eventType:e.type,timestamp:Date.now(),tagName:t.tagName,attributes:i,textContent:this.checkIfIsPIIDataAndClean(null===(n=t.textContent)||void 0===n?void 0:n.trim()),pageUrl:window.location.href,sessionId:this.config.sessionId,userId:this.config.userId,parent:{tagName:t.parentNode.parentElement.tagName,attributes:r,textContent:this.checkIfIsPIIDataAndClean(null===(a=t.parentNode.parentElement.textContent)||void 0===a?void 0:a.trim())},parentOfParent:{tagName:t.parentNode.parentElement.parentNode.parentElement.tagName,attributes:o,textContent:this.checkIfIsPIIDataAndClean(null===(s=t.parentNode.parentElement.parentNode.parentElement.textContent)||void 0===s?void 0:s.trim())}}}checkIfIsPIIDataAndClean(e){let t=e;return/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})$/.test(e)?t="redacted-cc":/^[a-zA-Z]+(?: [a-zA-Z]+)+$/.test(e)?t="redacted-name":/^\d{3}-\d{2}-\d{4}$/.test(e)?t="redacted-ssn":/(?:\+?(\d{1,3}))?[-.\s]?(?:\((\d{1,4})\)|(\d{1,4}))?[-.\s]?(\d{1,4})[-.\s]?(\d{1,4})[-.\s]?(\d{1,9})/.test(e)?t="redacted-phone":/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)?t="redacted-email":/^\d{4}-\d{2}-\d{2}$/.test(e)?t="redacted-dob":/^[A-Z0-9]+$/.test(e)&&(t="redacted-passport"),t}findInteractableParent(e){for(;e&&e!==document.body&&e!==document.documentElement;){if(this.isInteractable(e))return e;e=e.parentElement}return null}isInteractable(e){return!!this.defaultInteractableTags.concat(this.config.additionalInteractableTags||[]).includes(e.tagName)||!(!this.config.interactableAttribute||!e.hasAttribute(this.config.interactableAttribute))}getElementAttributes(e){const t=["data-email","data-cc-number","data-social-security-number","data-account-number","data-gender","data-birth-date","data-birth-date","data-birth-date","data-full-name"];return Array.from(e.attributes).reduce(((e,n)=>(t.includes(n.name)||(e[n.name]=n.value),e)),{})}}}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}var a={};return(()=>{var e=a;Object.defineProperty(e,"__esModule",{value:!0});const t=n(976);function s(){let e=sessionStorage.getItem("sessionId");return e||(e="sess-"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("sessionId",e)),e}function i(){let e=localStorage.getItem("userId");return e||(e="user-"+Math.random().toString(36).substr(2,9),localStorage.setItem("userId",e)),e}window.nullRecorder=function(e){e=Object.assign(Object.assign({},e),{sessionId:s(),userId:i()}),new t.default(e,(t=>{e.apiKey?fetch(`https://ohzzb0pmv7.execute-api.eu-west-2.amazonaws.com/prod/events/${e.companyId}`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":e.apiKey},body:JSON.stringify(t)}).then((e=>{if(e.ok)return e.json()})).then((e=>{})).catch((e=>{})):console.error("Nullfreak: Missing apiKey")})).init()}})(),a})()));